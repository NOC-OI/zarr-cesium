"use strict";(self.webpackChunkzarr_cesium_docs=self.webpackChunkzarr_cesium_docs||[]).push([[8765],{8453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>d});var s=n(6540);const i={},a=s.createContext(i);function l(e){const r=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(a.Provider,{value:r},e.children)}},9135:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"providers/zarr-layer-provider","title":"ZarrLayerProvider","description":"The ZarrLayerProvider allows you to render 2D raster data from Zarr datasets as a Cesium imagery layer.","source":"@site/docs/providers/zarr-layer-provider.md","sourceDirName":"providers","slug":"/providers/zarr-layer-provider","permalink":"/zarr-cesium/docs/docs/providers/zarr-layer-provider","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"ZarrLayerProvider"},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started","permalink":"/zarr-cesium/docs/docs/getting-started"},"next":{"title":"ZarrCubeProvider","permalink":"/zarr-cesium/docs/docs/providers/zarr-cube-provider"}}');var i=n(4848),a=n(8453);const l={sidebar_position:3,title:"ZarrLayerProvider"},d="ZarrLayerProvider",t={},c=[{value:"When to Use ZarrLayerProvider",id:"when-to-use-zarrlayerprovider",level:2},{value:"Basic Example",id:"basic-example",level:2},{value:"Layer Options",id:"layer-options",level:2},{value:"Dimension Selectors",id:"dimension-selectors",level:2},{value:"Creating a Layer",id:"creating-a-layer",level:2},{value:"Static constructor",id:"static-constructor",level:3},{value:"Runtime API",id:"runtime-api",level:2},{value:"Update Style (colormap, scale and opacity)",id:"update-style-colormap-scale-and-opacity",level:3},{value:"Update dimension slicing",id:"update-dimension-slicing",level:3},{value:"Supported CRS",id:"supported-crs",level:3},{value:"Multiscale (Pyramidal) Zarr",id:"multiscale-pyramidal-zarr",level:3},{value:"No-data Handling",id:"no-data-handling",level:3},{value:"Performance Notes",id:"performance-notes",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"zarrlayerprovider",children:"ZarrLayerProvider"})}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.strong,{children:"ZarrLayerProvider"})," allows you to render ",(0,i.jsx)(r.strong,{children:"2D raster data from Zarr datasets"})," as a Cesium imagery layer.\nIt handles:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Reading Zarr metadata and multiscale pyramids"}),"\n",(0,i.jsx)(r.li,{children:"WebGL rendering of tiles (fast GPU-based color mapping)"}),"\n",(0,i.jsx)(r.li,{children:"Dynamic slicing of dimensions (e.g., time, elevation)"}),"\n",(0,i.jsx)(r.li,{children:"Runtime style updates (colormap, scale, opacity)"}),"\n",(0,i.jsxs)(r.li,{children:["CRS detection (",(0,i.jsx)(r.code,{children:"EPSG:4326"})," / ",(0,i.jsx)(r.code,{children:"EPSG:3857"}),")"]}),"\n",(0,i.jsxs)(r.li,{children:["Smooth integration with Cesium\u2019s ",(0,i.jsx)(r.code,{children:"ImageryLayer"})," collection"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"This provider works as a drop-in replacement for Cesium imagery layers, enabling you to visualize 2D scalar fields (e.g., temperature, salinity, chlorophyll) stored in Zarr format, without any server-side preprocessing or conversion."}),"\n",(0,i.jsx)(r.h2,{id:"when-to-use-zarrlayerprovider",children:"When to Use ZarrLayerProvider"}),"\n",(0,i.jsxs)(r.p,{children:["Use ",(0,i.jsx)(r.strong,{children:"ZarrLayerProvider"})," when your dataset is:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"2D (lat \xd7 lon)"}),"\n",(0,i.jsxs)(r.li,{children:["Optionally has ",(0,i.jsx)(r.strong,{children:"extra dimensions"}),": ",(0,i.jsx)(r.code,{children:"time"}),", ",(0,i.jsx)(r.code,{children:"elevation"}),", ",(0,i.jsx)(r.code,{children:"depth"}),", etc."]}),"\n",(0,i.jsxs)(r.li,{children:["Stored as a ",(0,i.jsx)(r.strong,{children:"Zarr array"}),", possibly multiscale"]}),"\n",(0,i.jsxs)(r.li,{children:["Represents ",(0,i.jsx)(r.strong,{children:"scalar fields"})," (not vectors)"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"If you need:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["3D rendering \u2192 use ",(0,i.jsx)(r.a,{href:"/zarr-cesium/docs/docs/providers/zarr-cube-provider",children:(0,i.jsx)(r.strong,{children:"ZarrCubeProvider"})})]}),"\n",(0,i.jsxs)(r.li,{children:["3D vector fields \u2192 use ",(0,i.jsx)(r.a,{href:"/zarr-cesium/docs/docs/providers/zarr-cube-velocity-provider",children:(0,i.jsx)(r.strong,{children:"ZarrCubeVelocityProvider"})})]}),"\n",(0,i.jsxs)(r.li,{children:["2D tiled imagery using a backend server \u2192 use ",(0,i.jsx)(r.a,{href:"https://github.com/developmentseed/titiler",children:(0,i.jsx)(r.strong,{children:"titiler"})})]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"basic-example",children:"Basic Example"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"import { Viewer } from 'cesium';\nimport { ZarrLayerProvider } from '@noc-oi/zarr-cesium';\n\nconst viewer = new Viewer('cesiumContainer');\n\nconst options = {\n  url: 'https://example.com/data.zarr',\n  variable: 'salinity',\n  colormap: 'viridis',\n  scale: [30, 40]\n};\n\nconst layer = await ZarrLayerProvider.createLayer(viewer, options);\n\nviewer.imageryLayers.add(layer);\n"})}),"\n",(0,i.jsx)(r.h2,{id:"layer-options",children:"Layer Options"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"export interface LayerOptions {\n  url: string; // Public Zarr store\n  variable: string; // Zarr array name\n  scale?: [number, number]; // Min/max for color scaling\n  colormap?: ColorMapName; // Name from jsColormaps, based on matplotlib colormaps\n  opacity?: number; // Imagery opacity (0\u20131)\n  tileWidth?: number; // Cesium tile size (default 256)\n  tileHeight?: number; // Cesium tile size (default 256)\n  minimumLevel?: number; // Min zoom level\n  maximumLevel?: number; // Max zoom level\n  dimensionNames?: DimensionNamesProps; // Custom dimension names. If not provided, defaults will be used or identified automatically based on CF conventions.\n  selectors?: Record<string, ZarrSelectorsProps>; // Initial dimension slices\n  zarrVersion?: 2 | 3; // Zarr version (auto-detected if not set)\n  crs?: 'EPSG:4326' | 'EPSG:3857'; // Force CRS (auto-detected if not set)\n  noDataMin?: number; // Custom no-data minimum value. Overrides _FillValue/missing_value.\n  noDataMax?: number; // Custom no-data maximum value. Overrides _FillValue/missing_value.\n}\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"dimension-selectors",children:"Dimension Selectors"}),"\n",(0,i.jsxs)(r.p,{children:["If your Zarr dataset has dimensions like: ",(0,i.jsx)(r.code,{children:"time"}),", ",(0,i.jsx)(r.code,{children:"level"})," related (e.g. ",(0,i.jsx)(r.code,{children:"depth"}),", ",(0,i.jsx)(r.code,{children:"elevation"}),"), and others, you can slice them using the ",(0,i.jsx)(r.code,{children:"selectors"})," option."]}),"\n",(0,i.jsx)(r.p,{children:"You can set an initial slice using:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"selectors: {\n  time: { type: 'index', selected: 0 },\n  elevation: { type: 'index', selected: 10 }\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Or slice by ",(0,i.jsx)(r.strong,{children:"value"})," instead of index:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"selectors: {\n  time: { type: 'value', selected: '2020-01-01T00:00Z' },\n  elevation: { type: 'value', selected: 50 } // meters\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["The provider automatically converts value\u2192index using nearest-neighbor lookup. The default behavior (if no selectors are provided) is to select the first index (",(0,i.jsx)(r.code,{children:"0"}),") for each dimension."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"creating-a-layer",children:"Creating a Layer"}),"\n",(0,i.jsx)(r.h3,{id:"static-constructor",children:"Static constructor"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"const imageryLayer = await ZarrLayerProvider.createLayer(viewer, options);\nviewer.imageryLayers.add(imageryLayer);\n"})}),"\n",(0,i.jsx)(r.p,{children:"This method:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Creates the provider"}),"\n",(0,i.jsx)(r.li,{children:"Loads Zarr metadata"}),"\n",(0,i.jsx)(r.li,{children:"Detects CRS"}),"\n",(0,i.jsx)(r.li,{children:"Sets tiling scheme"}),"\n",(0,i.jsx)(r.li,{children:"Loads the first dimension slice"}),"\n",(0,i.jsxs)(r.li,{children:["Returns a ready-to-use ",(0,i.jsx)(r.code,{children:"ZarrImageryLayer"})]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"runtime-api",children:"Runtime API"}),"\n",(0,i.jsxs)(r.p,{children:["When added to Cesium, the layer behaves like a normal ",(0,i.jsx)(r.code,{children:"ImageryLayer"}),", ",(0,i.jsx)(r.strong,{children:"plus extra Zarr-specific features"}),"."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"const zbLayer = await ZarrLayerProvider.createLayer(viewer, options);\nviewer.imageryLayers.add(zbLayer);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"update-style-colormap-scale-and-opacity",children:"Update Style (colormap, scale and opacity)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"colormap"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"zbLayer.updateStyle({ colormap: 'plasma' });\n"})}),"\n",(0,i.jsxs)(r.p,{children:["The full list of supported colormaps is available in the ",(0,i.jsx)(r.a,{href:"/zarr-cesium/docs/docs/api/type-aliases/ColorMapName",children:"Colormaps section"}),"."]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"scale range"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"zbLayer.updateStyle({ scale: [20, 35] });\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"opacity"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"zbLayer.updateStyle({ opacity: 0.5 });\n// or using Cesium ImageryLayer API\n// zbLayer.alpha = 0.5;\n"})}),"\n",(0,i.jsxs)(r.p,{children:["After updating style, the layer performs a ",(0,i.jsx)(r.strong,{children:"soft refresh"})," so Cesium re-renders the tiles in the viewport with the new style."]}),"\n",(0,i.jsx)(r.h3,{id:"update-dimension-slicing",children:"Update dimension slicing"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"zbLayer.updateSelectors({\n  time: { type: 'index', selected: 5 }\n});\n"})}),"\n",(0,i.jsx)(r.p,{children:"You can get the list of current dimension and current selectors values using:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"const dimValues = zbLayer.provider.dimensionValues;\nconst selectors = zbLayer.provider.selectors;\n"})}),"\n",(0,i.jsx)(r.p,{children:"This returns a mapping of dimension names to their list of values, e.g.:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"dimNames = {\n  time: ['2020-01-01T00:00Z', '2020-01-02T00:00Z', ...],\n  elevation: [0, 10, 20, 30, ...]\n}\n"})}),"\n",(0,i.jsx)(r.p,{children:"And the current selectors:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"selectors = {\n  time: { type: 'index', selected: 5 },\n  elevation: { type: 'index', selected: 2 }\n};\n"})}),"\n",(0,i.jsx)(r.p,{children:"And with that, you can build UI controls (sliders, dropdowns) to update the layer dynamically."}),"\n",(0,i.jsx)(r.h3,{id:"supported-crs",children:"Supported CRS"}),"\n",(0,i.jsx)(r.p,{children:"Zarr datasets may store coordinate values in:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"EPSG:4326"})," (lat, lon degrees)"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"EPSG:3857"})," (Web Mercator meters)"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"The provider detects the CRS automatically using:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Zarr metadata"}),"\n",(0,i.jsx)(r.li,{children:"consolidated metadata"}),"\n",(0,i.jsx)(r.li,{children:"coordinate ranges (West/East > 360 \u2192 Web Mercator)"}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"multiscale-pyramidal-zarr",children:"Multiscale (Pyramidal) Zarr"}),"\n",(0,i.jsxs)(r.p,{children:["If the dataset contains Zarr multiscale metadata (generated by ",(0,i.jsx)(r.a,{href:"https://github.com/carbonplan/ndpyramid",children:"ndpyramid"}),"):"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'"multiscales": [\n  {\n    "datasets": [\n      {"path": "0"}, {"path": "1"}, {"path": "2"}\n    ]\n  }\n]\n'})}),"\n",(0,i.jsx)(r.p,{children:"The provider automatically:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"chooses the best level based on Cesium zoom"}),"\n",(0,i.jsx)(r.li,{children:"caches levels (LRU = 3)"}),"\n",(0,i.jsx)(r.li,{children:"correctly slices each level"}),"\n",(0,i.jsx)(r.li,{children:"uses metadata-supported shapes for accurate scaling"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"No extra configuration is required."}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h3,{id:"no-data-handling",children:"No-data Handling"}),"\n",(0,i.jsx)(r.p,{children:"Automatically applies:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:"_FillValue"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.code,{children:"missing_value"})}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"valid_min"})," / ",(0,i.jsx)(r.code,{children:"valid_max"})]}),"\n",(0,i.jsx)(r.li,{children:"or custom range"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"Example of custom range:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:"noDataMin: -9999, // defaults is to Zarr attributes and then -9999\nnoDataMax: 9999 // defaults is to Zarr attributes and then 9999\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"performance-notes",children:"Performance Notes"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"WebGL tile rendering is extremely fast"}),"\n",(0,i.jsx)(r.li,{children:"Multiscale/pyramid datasets dramatically improve speed"}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"ImageBitmap"})," acceleration is used when available"]}),"\n",(0,i.jsx)(r.li,{children:"Uses internal concurrency throttling (4 parallel reads)"}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Feature"}),(0,i.jsx)(r.th,{children:"Supported"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"2D raster Zarr"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Zarr v2 & v3"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Time dimension"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Elevation/depth"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Multiscale pyramids"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"WebGL GPU shading"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Colormap updates"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Dynamic slicing"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"CRS auto-detection"}),(0,i.jsx)(r.td,{children:"\u2714\ufe0f"})]})]})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.a,{href:"/zarr-cesium/docs/docs/providers/zarr-cube-provider",children:"ZarrCubeProvider"})})," \u2013 render 3D volumes"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.a,{href:"/zarr-cesium/docs/docs/providers/zarr-cube-velocity-provider",children:"ZarrCubeVelocityProvider"})})," \u2013 render vector fields"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:(0,i.jsx)(r.a,{href:"/zarr-cesium/docs/docs/data",children:"Data Preparation"})})," \u2013 Prepare Zarr datasets for the browser"]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{})})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);