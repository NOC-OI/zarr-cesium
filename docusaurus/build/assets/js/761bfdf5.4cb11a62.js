"use strict";(self.webpackChunkzarr_cesium_docs=self.webpackChunkzarr_cesium_docs||[]).push([[1088],{8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>d});var s=n(6540);const i={},t=s.createContext(i);function a(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:r},e.children)}},8890:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"data","title":"Data Preparation","description":"Zarr-Cesium works best when datasets are prepared with web visualization constraints in mind:","source":"@site/docs/data.md","sourceDirName":".","slug":"/data","permalink":"/zarr-cesium/docs/docs/data","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Data Preparation"},"sidebar":"tutorialSidebar","previous":{"title":"ZarrCubeVelocityProvider","permalink":"/zarr-cesium/docs/docs/providers/zarr-cube-velocity-provider"},"next":{"title":"API Reference","permalink":"/zarr-cesium/docs/docs/api/"}}');var i=n(4848),t=n(8453);const a={sidebar_position:6,title:"Data Preparation"},d="Data Preparation for Zarr-Cesium",l={},o=[];function c(e){const r={a:"a",code:"code",h1:"h1",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"data-preparation-for-zarr-cesium",children:"Data Preparation for Zarr-Cesium"})}),"\n",(0,i.jsxs)(r.p,{children:["Zarr-Cesium works best when datasets are prepared with ",(0,i.jsx)(r.strong,{children:"web visualization constraints"})," in mind:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Projection"}),"\n",(0,i.jsx)(r.li,{children:"Chunking"}),"\n",(0,i.jsx)(r.li,{children:"Multiscale pyramids"}),"\n",(0,i.jsx)(r.li,{children:"Zarr format"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"This page summarises the full workflow used for preparing large ocean model datasets for browser-based visualization."}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"1-reprojecting-curvilinear--rotated-pole-grids",children:"1. Reprojecting Curvilinear / Rotated-Pole Grids"}),"\n",(0,i.jsxs)(r.p,{children:["Many ocean and climate models (e.g., NEMO, MOM6) use curvilinear or rotated-pole grids (",(0,i.jsx)(r.code,{children:"nav_lat"}),", ",(0,i.jsx)(r.code,{children:"nav_lon"}),").\nBrowsers expect ",(0,i.jsx)(r.strong,{children:"EPSG:4326"})," or ",(0,i.jsx)(r.strong,{children:"EPSG:3857"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Use ",(0,i.jsx)(r.a,{href:"https://scitools-iris.readthedocs.io/",children:(0,i.jsx)(r.code,{children:"iris"})})," or ",(0,i.jsx)(r.a,{href:"https://xesmf.readthedocs.io/en/",children:(0,i.jsx)(r.code,{children:"xESMF"})})," to reproject:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'import xesmf as xe\n\nlon_target = np.linspace(-180, 180, 360))\nlat_target = np.linspace(-90, 90, 240))\n\ntarget_grid = xr.Dataset(\n    {\n        "lon": (["lon"], lon_target),\n        "lat": (["lat"], lat_target),\n    },\n)\nregridder = xe.Regridder(\n    ds_source,\n    target_grid,\n    method="bilinear"\n)\nregridded_ds = regridder(ds_source)\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"2-chunking-for-web-performance",children:"2. Chunking for Web Performance"}),"\n",(0,i.jsx)(r.p,{children:"Chunk size dramatically affects browser speed."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Best practices:"})}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Workflow"}),(0,i.jsx)(r.th,{children:"Ideal chunk size"}),(0,i.jsx)(r.th,{children:"Why"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"HPC / analysis"}),(0,i.jsx)(r.td,{children:"10\u2013100 MB"}),(0,i.jsx)(r.td,{children:"Efficient for Dask"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Web visualization"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"100\u2013500 KB"})}),(0,i.jsx)(r.td,{children:"Fast requests, limits latency"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Map tiles"}),(0,i.jsx)(r.td,{children:"256\xd7256 or 512\xd7512"}),(0,i.jsx)(r.td,{children:"Aligns with screen tiles"})]})]})]}),"\n",(0,i.jsx)(r.p,{children:"Avoid chunking across non-spatial dimensions (time, depth):"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'reprojected_ds = reprojected_ds.chunk({\n    "time": 1,\n    "latitude": 256,\n    "longitude": 256\n})\n'})}),"\n",(0,i.jsxs)(r.p,{children:["This lets the browser fetch only the ",(0,i.jsx)(r.strong,{children:"visible slice"}),"."]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"3-building-multiscale-pyramids",children:"3. Building Multiscale Pyramids"}),"\n",(0,i.jsxs)(r.p,{children:["To support seamless zooming, convert your dataset to a pyramid representation using ",(0,i.jsx)(r.a,{href:"https://github.com/carbonplan/ndpyramid",children:(0,i.jsx)(r.code,{children:"ndpyramid"})}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'from ndpyramid import pyramid_resample\n\npyramid_ds = pyramid_resample(\n    reprojected_ds,\n    x="longitude",\n    y="latitude",\n    levels=6,\n    resampling="nearest",\n)\n'})}),"\n",(0,i.jsx)(r.p,{children:"Output structure:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"multiscale.zarr/\n\u251c\u2500\u2500 0/    # lowest resolution\n\u251c\u2500\u2500 1/    # 2\xd7 highres\n\u251c\u2500\u2500 2/    # 4\xd7 highres\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,i.jsx)(r.p,{children:"Zarr-Cesium\u2019s 2D provider automatically selects levels based on zoom. For the 3D providers, you can specify the desired level."}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"4-zarr-format",children:"4. Zarr Format"}),"\n",(0,i.jsxs)(r.p,{children:["If you are using ",(0,i.jsx)(r.strong,{children:"Zarr v2"}),", write the final dataset to with consolidated metadata:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'pyramid_ds.to_zarr("multiscale.zarr", consolidated=True, zarr_version=2)\n'})}),"\n",(0,i.jsx)(r.p,{children:"This ensures compatibility with Zarr-Cesium and efficient loading in the browser."}),"\n",(0,i.jsxs)(r.p,{children:["If you are using ",(0,i.jsx)(r.strong,{children:"Zarr v3"}),", ensure your Zarr store is accessible via HTTP(S) and follows the Zarr v3 specification:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'pyramid_ds.to_zarr("multiscale.zarr",, zarr_version=3)\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"5-example-dataset",children:"5. Example Dataset"}),"\n",(0,i.jsx)(r.p,{children:"Here\u2019s a smoother, more polished version:"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsxs)(r.p,{children:["This workflow was developed using ",(0,i.jsx)(r.strong,{children:"approximately 30 GB of NEMO NPD ocean model output"})," (documentation available at ",(0,i.jsx)(r.a,{href:"https://noc-msm.github.io/NOC_Near_Present_Day/",children:"https://noc-msm.github.io/NOC_Near_Present_Day/"}),"). The dataset includes:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Multiple physical variables"}),"\n",(0,i.jsx)(r.li,{children:"Depth and time dimensions"}),"\n",(0,i.jsx)(r.li,{children:"A reprojected rotated-pole grid"}),"\n",(0,i.jsx)(r.li,{children:"Chunking and multiscale pyramids optimised for web delivery"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"We also provide a sample atmospheric dataset for testing wind-related visualisations. This dataset contains U/V wind components on a regular latitude\u2013longitude grid, processed with the same workflow, and derived from the ERA5 reanalysis of Hurricane Florence."}),"\n",(0,i.jsxs)(r.p,{children:["A full list of available datasets is provided in the ",(0,i.jsx)(r.strong,{children:"data information file"})," on ",(0,i.jsx)(r.a,{href:"https://github.com/NOC-OI/zarr-cesium/blob/dev/demo/src/application/data/layers-json.tsx",children:"demo/src/application/data/layers-json.tsx"}),"."]}),"\n",(0,i.jsx)(r.p,{children:"A full demo is available:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["GitHub: ",(0,i.jsx)(r.a,{href:"https://github.com/NOC-OI/zarr-vis/demo",children:"https://github.com/NOC-OI/zarr-vis/demo"})]}),"\n",(0,i.jsxs)(r.li,{children:["Live demo: ",(0,i.jsx)(r.a,{href:"https://noc-oi.github.io/zarr-vis/",children:"https://noc-oi.github.io/zarr-vis/"})]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"summary-workflow",children:"Summary Workflow"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Curvilinear Model Output\n        \u2193\nReproject (iris / xESMF)\n        \u2193\nRechunk (small spatial chunks)\n        \u2193\nBuild pyramids (ndpyramid)\n        \u2193\nWrite Zarr v2 (consolidated metadata)\n        \u2193\nLoad in browser (Zarr-Cesium)\n"})}),"\n",(0,i.jsxs)(r.p,{children:["This pipeline allows ",(0,i.jsx)(r.strong,{children:"real-time, fully client-side visualization"})," of multi-GB geospatial datasets directly in CesiumJS."]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);